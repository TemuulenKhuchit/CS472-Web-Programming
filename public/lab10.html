<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Lab 10</title>
    <link rel="stylesheet" href="../css/styles.css" />
  </head>
  <body>
    <div class="container">
      <h1>Lab 10</h1>

      <h2>Topic: Express</h2>

      <h3>Exercise 1:</h3>
      <p>Convert the Lab09 Question2 to the Express application.</p>
      <div class="answer-label">Code:</div>
      <pre class="code-block">
import express from "express";
import { createReadStream } from "fs";
import { join } from "path";
import { fileURLToPath } from "url";
import { dirname } from "path";
const app = express();

const __filename = fileURLToPath(import.meta.url);
const __dirname = dirname(__filename);

app.get("/image", (req, res) => {
  const imagePath = join(__dirname, "../src/happy.jpg");
  res.setHeader("Content-Type", "image/jpeg");
  const readStream = createReadStream(imagePath);
  readStream.pipe(res);
});

app.get("/pdf", (req, res) => {
  const pdfPath = join(__dirname, "../src/lab10.pdf");
  res.setHeader("Content-Type", "application/pdf");
  const readStream = createReadStream(pdfPath);
  readStream.pipe(res);
});

app.get("/about", (req, res) => {
  const textPath = join(__dirname, "../src/JustText.txt");
  res.setHeader("Content-Type", "text/plain");
  const readStream = createReadStream(textPath);
  readStream.pipe(res);
});

app.get(["/home", "/"], (req, res) => {
  res.send("Welcome to my website");
});

app.use((req, res) => {
  res.status(404).send("404 Not Found");
});

const port = 3000;
app.listen(port, () => {
  console.log(`Server is running on http://localhost:${port}`);
});
      </pre>

      <h3>Exercise 2:</h3>
      <p>Write an Express application to provide a calculator API.</p>
      <ul>
        <li>
          There should be an API endpoint for each basic math operation: addition, subtraction, multiplication,
          division, and modulus.
        </li>
        <li>
          Each endpoint will receive the input numbers and return a JSON response with the results as follows: {
          results: 0 }.
        </li>
        <li>
          The calculator router should be designed with flexibility to receive the input numbers as query parameters,
          parameters, or in the body as JSON or urlEncoded format, For example, all these requests will return the same
          results value { results: 5 }:
          <ul>
            <li>GET /addition/2/3</li>
            <li>GET /addition/?a=2&b=3</li>
            <li>POST /addition/ BODY ?a=2&b=3</li>
            <li>POST /addition/ BODY {a:2,b:3}</li>
          </ul>
        </li>
      </ul>
      <div class="answer-label">Code:</div>
      <pre class="code-block">
import express from "express";
import pkg from "body-parser";
const { json, urlencoded } = pkg;

const app = express();
app.use(json()); // For parsing application/json
app.use(urlencoded({ extended: true })); // For parsing application/x-www-form-urlencoded

const getNumbers = (req) => {
  let a = parseFloat(req.params.a || req.query.a || req.body.a);
  let b = parseFloat(req.params.b || req.query.b || req.body.b);
  return { a, b };
};

app.get("/addition/:a?/:b?", (req, res) => {
  const { a, b } = getNumbers(req);
  res.json({ results: a + b });
});

app.post("/addition", (req, res) => {
  const { a, b } = getNumbers(req);
  res.json({ results: a + b });
});

app.get("/subtraction/:a?/:b?", (req, res) => {
  const { a, b } = getNumbers(req);
  res.json({ results: a - b });
});

app.post("/subtraction", (req, res) => {
  const { a, b } = getNumbers(req);
  res.json({ results: a - b });
});

app.get("/multiplication/:a?/:b?", (req, res) => {
  const { a, b } = getNumbers(req);
  res.json({ results: a * b });
});

app.post("/multiplication", (req, res) => {
  const { a, b } = getNumbers(req);
  res.json({ results: a * b });
});

app.get("/division/:a?/:b?", (req, res) => {
  const { a, b } = getNumbers(req);
  if (b === 0) {
    res.status(400).json({ error: "Division by zero is not allowed" });
  } else {
    res.json({ results: a / b });
  }
});

app.post("/division", (req, res) => {
  const { a, b } = getNumbers(req);
  if (b === 0) {
    res.status(400).json({ error: "Division by zero is not allowed" });
  } else {
    res.json({ results: a / b });
  }
});

// Modulus
app.get("/modulus/:a?/:b?", (req, res) => {
  const { a, b } = getNumbers(req);
  res.json({ results: a % b });
});

app.post("/modulus", (req, res) => {
  const { a, b } = getNumbers(req);
  res.json({ results: a % b });
});

// Start the server
const port = 3000;
app.listen(port, () => {
  console.log(`Calculator API running at http://localhost:${port}`);
});
      </pre>
    </div>
  </body>
</html>
